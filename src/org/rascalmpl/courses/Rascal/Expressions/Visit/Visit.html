<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">

<!---- DO NOT EDIT: HTML generated by CourseCompiler ---->


<head>
<title>Rascal/Expressions/Visit</title>

<meta name="description" content="Rascal/Expressions/Visit:  Visit the elements in a tree or value.">

<meta name="keywords" content="Rascal/Expressions/Visit, Rascal, meta-programming, software analysis, software transformation">
<link type="text/css" rel="stylesheet" href="/prelude.css"/>
<link type="text/css" rel="stylesheet" href="/jquery.autocomplete.css"/>
<script type="text/javascript" src="/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="/jquery.colorbox-min.js"></script>
<script type="text/javascript" src="/jquery.cookie.js"></script>
<script type="text/javascript" src="/jquery.jstree.js"></script>
<script type="text/javascript" src="/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/jquery.history.js"></script>
<script type="text/javascript" src="/globals.js"></script>
<script type="text/javascript" src="/prelude.js"></script>
<script type="text/javascript" src="/Rascal/course.js"></script>

</head>
<body>
<table id="container"><tr><td id="tdlogo"><a id="tutorAction" href="/index.html"><img id="leftIcon" height="40" width="40" src="/images/rascal-tutor-small.png"></a></td><td id="tdsearch">
<div id="searchBox">
  <form method="GET" id="searchForm" action="/search"> 
    <img id="searchIcon" height="20" width="20" src="/images/magnify.png">
    <input type="hidden" name="concept" value="Rascal/Expressions/Visit">
    <input type="text" id="searchField" name="term" autocomplete="off"><br />
    <div id="popups"></div>
  </form>
</div>
         </td></tr><tr><td id="tdnav">
<a id="navPanePlaceHolder" href="/Rascal/navigate.html" >Navigation</a>
<script type="text/javascript"> var navigationPaneSource="/Rascal/navigate.html"; </script></td><td id="tdconcept">
<div id="conceptPane">

<div id="Name">
<span class="sectionHead">Name</span> <a href="/Rascal/Rascal.html">Rascal</a>/<a href="/Rascal/Expressions/Expressions.html">Expressions</a>/<a href="/Rascal/Expressions/Visit/Visit.html">Visit</a>
</div>

<div id="Synopsis">
<span class="sectionHead">Synopsis</span>  Visit the elements in a tree or value.

</div>

	                       
<div id="Syntax">
<span class="sectionHead">Syntax</span>  <pre class="listing">Strategy visit ( <i>Exp</i> ) {
case <i>PatternWithAction</i><sub>1</sub>;
case <i>PatternWithAction</i><sub>2</sub>;
...
default: ...
}
</pre>
</div>

                           
                           
                           
<div id="Description">
<span class="sectionHead">Description</span>  Visiting the nodes in a tree is a very common task in the <a href="/EASY/EASY.html">EASY</a> domain. 
 In many cases (but certainly not all) the tree is a syntax tree of some source code file 
 and the nodes correspond to expressions or statements. 
 Computing metrics or refactoring are examples of tasks that require a tree visit. 
 In object-oriented programming, the <i>visitor pattern</i> is in common use for this,
 see <a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern<img src="/images/www-icon.png" with="20" height="20"></a>.
 There are three frequently occurring scenarios:
  <ul><li> Accumulator: traverse the tree and collect information.</li>
<li> Transformer: traverse the tree and transform it into another tree.</li>
<li> Accumulating Transformer: traverse the tree, collect information and also transform the tree.</li>
</ul> The visit expression in Rascal can accommodate all these (and more) use cases.
 <br/>
<br/>

 Given a subject term (the current value of <code><i>Exp</i></code>) and a list of cases 
 (consisting of a sequence of <a href="/Rascal/Patterns/PatternWithAction/PatternWithAction.html">PatternWithAction</a>s, it traverses the term. 
 Depending on the precise actions it may perform replacement (mimicking a transformer), 
 update local variables (mimicking an accumulator) or a combination of these two (accumulating transformer). 
 If <b>any</b> of the actions contains an <a href="/Rascal/Statements/Insert/Insert.html">Insert</a> statement, 
 the value of the visit expression is a new value that is obtained by successive insertions in the subject 
 term by executing one or more cases. Otherwise, the original value of the subject term is returned.
 <br/>
<br/>

 <br/>
<br/>

 The visit expression is optionally preceded by one of the following strategy indications that 
 determine the traversal order of the subject:
  <ul><li> <code>top-down</code>: visit the subject from root to leaves.</li>
<li> <code>top-down-break</code>: visit the subject from root to leaves, but stop at the current path when a case matches.</li>
<li> <code>bottom-up</code>: visit the subject from leaves to root (this is the default).</li>
<li> <code>bottom-up-break</code>: visit the subject from leaves to root, but stop at the current path when a case matches.</li>
<li> <code>innermost</code>: repeat a bottom-up traversal as long as the traversal changes the resulting value (compute a fixed-point).</li>
<li> <code>outermost</code>: repeat a top-down traversal as long as the traversal changes the resulting value (compute a fixed-point).</li>
</ul> The execution of the cases has the following effect:
  <ul><li> A PatternWithAction of the form <code><i>Pattern</i> => <i>Exp</i></code> replaces the current subtree of the subject by the value of <code><i>Exp</i></code>.  Note that a copy of the subject is created at the start of the visit statement and all replacements are made in this copy. 
 As a consequence, modifications made during the visit cannot influence matches later on.
 The modified copy of the subject is ultimately returned by the visit expression.
</li>
<li> A PatternWithAction of the form <code><i>Pattern</i> : <i>Statement</i></code> executes <code>Statement</code> and this should lead to one of the following: <ul><li> Execution of an Insert statement of the form <code>insert <i>Exp</i><sub>2</sub></code>. The value of <code><i>Exp</i><sub>2</sub></code> replaces the subtree of the subject that is currently being visited. 
 Once again, this modification takes place in a copy of the original subject (see above).
 Note that:
 <ul><li> An insert statement may only occur in a PatternWithAction in a visit expression or a rule.</li>
<li> <code><i>Pattern</i> => <i>Exp</i></code> is equivalent to <code><i>Pattern</i> : insert <i>Exp</i>;</code>.</li>
</ul></li>
<li> Execution of a <a href="/Rascal/Statements/Fail/Fail.html">Fail</a> statement: all side effects of <code><i>Statement</i></code> are undone, no insertion is made, and the next case is tried.</li>
<li> Execution of a <a href="/Rascal/Statements/Return/Return.html">Return</a> statement that returns a value from the enclosing function.</li>
</ul></li>
</ul> The precise behaviour of the visit expression depends on the type of the subject:
  <ul><li> For type node or ADT, all nodes of the tree are visited (in the order determined by the strategy).  Concrete patterns and abstract patterns directly match tree nodes. 
 Regular expression patterns match only values of type string.
</li>
<li> For other structured types (list, set, map, tuple, rel), the elements of the structured type are visited and  matched against the cases. 
 When inserts are made, a new structured value is created. In these cases a strategy does not have any effect.
</li>
</ul>
</div>

  	                       
<div id="Examples">
<span class="sectionHead">Examples</span>  Visit a value and increment a counter for pattern <code>leaf(int N)</code> matches:
 <pre class="listing">visit(t) {
     case leaf(int N): c = c + N;   
   };
</pre> Replace all values that match the pattern <code>red(l, r)</code>:
 <pre class="listing">visit(t) {
     case red(l, r) => green(l, r)   
   };
</pre> Do a bottom-up visit of an expression and apply the function <code>simp</code> to each subexpression:
 <pre class="listing">bottom-up visit(e){
           case Exp e1 => simp(e1)
         }
</pre> More examples can, for instance, be found in <a href="/Recipes/Common/ColoredTrees/ColoredTrees.html">Recipes:ColoredTrees</a>, <a href="/Recipes/Common/WordReplacement/WordReplacement.html">Recipes:WordReplacement</a>, <a href="/Recipes/Common/CountConstructors/CountConstructors.html">Recipes:CountConstructors</a>, and <a href="/Recipes/Common/Derivative/Derivative.html">Recipes:Derivative</a>.

</div>

  	                       
  	                       
  	                       
<div id="questions">


<br/>

<span class="sectionHead">Questions</span> <br/>


<div id="Rascal_Expressions_Visit_1" class="question">
<b>Question [1]. </b>
<span id="good_Rascal_Expressions_Visit_1" class="answerStatus">
<img height="25" width="25" src="/images/good.png"/>
</span>

<span id="bad_Rascal_Expressions_Visit_1" class="answerStatus">
<img height="25" width="25" src="/images/bad.png"/>
</span>

<span id="answerFeedback_Rascal_Expressions_Visit_1" class="answerFeedback"></span>
 Given a data type <code>ColoredTree</code>, complete the definition of the function <code>flipRedChildren</code> that exchanges the children of all red nodes.
<br/>

<form method="GET" action="validate" class="answerForm">Fill in <pre class="prequestion">data ColoredTree = leaf(int N)      
                 | red(ColoredTree left, ColoredTree right) 
                 | black(ColoredTree left, ColoredTree right);

ColoredTree rb = red(black(leaf(1), red(leaf(2),leaf(3))), black(leaf(3), leaf(4)));

public ColoredTree flipRedChildren(ColoredTree t){
  return visit(t){
     case red(l,r) =&gt; <input type="text" size="30" name="Rascal_Expressions_Visit_1:answer" class="answerText">
  };
}
</pre> and make the following true:<pre class="prequestion">flipRedChildren(rb) == red( black(leaf(3), leaf(4)), black(leaf(1), red(leaf(3),leaf(2))));</pre>
<input type="submit" value="Give answer" class="answerSubmit">
</form>
<form method="GET" action="validate" class="anotherForm"><input type="hidden" name="Rascal_Expressions_Visit_1:another" value="yes">

<input type="submit" value="I want another question" class="anotherSubmit">
</form><br/>

</div>
 <br/>

<br/>

</div>

<a id="tutorAction" href="/index.html"><img id="leftIcon" height="40" width="40" src="/images/rascal-tutor-small.png"></a><div id="editMenu">[<a id="editAction" href="/edit?concept=Rascal/Expressions/Visit&new=false"><b>Edit</b></a>] | 
               [<a id="newAction" href="/edit?concept=Rascal/Expressions/Visit&new=true"><b>New Subconcept</b></a>] |
               [<a id="compileAction" href="/compile?name=Rascal"><b>Recompile Course</b></a>] |
               [<a id="warnAction" href="/Rascal/warnings.html"><b>Warnings</b></a>]</div>
<span class="editMenuFooter">Is this page unclear, or have you spotted an error? Please add a comment below and help us to improve it. For all other questions and remarks, visit <a href="http://ask.rascal-mpl.org">ask.rascal-mpl.org</a>. </span>
</div>
</td></tr></table>
</body>
</html>