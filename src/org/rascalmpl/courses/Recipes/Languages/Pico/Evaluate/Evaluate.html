<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">

<!---- DO NOT EDIT: HTML generated by CourseCompiler ---->


<head>
<title>Recipes/Languages/Pico/Evaluate</title>

<meta name="description" content="Recipes/Languages/Pico/Evaluate:  Evaluate a Pico program.">

<meta name="keywords" content="Recipes/Languages/Pico/Evaluate, Rascal, meta-programming, software analysis, software transformation">
<link type="text/css" rel="stylesheet" href="/prelude.css"/>
<link type="text/css" rel="stylesheet" href="/jquery.autocomplete.css"/>
<script type="text/javascript" src="/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="/jquery.colorbox-min.js"></script>
<script type="text/javascript" src="/jquery.cookie.js"></script>
<script type="text/javascript" src="/jquery.jstree.js"></script>
<script type="text/javascript" src="/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/jquery.history.js"></script>
<script type="text/javascript" src="/globals.js"></script>
<script type="text/javascript" src="/prelude.js"></script>
<script type="text/javascript" src="/Recipes/course.js"></script>

</head>
<body>
<table id="container"><tr><td id="tdlogo"><a id="tutorAction" href="/index.html"><img id="leftIcon" height="40" width="40" src="/images/rascal-tutor-small.png"></a></td><td id="tdsearch">
<div id="searchBox">
  <form method="GET" id="searchForm" action="/search"> 
    <img id="searchIcon" height="20" width="20" src="/images/magnify.png">
    <input type="hidden" name="concept" value="Recipes/Languages/Pico/Evaluate">
    <input type="text" id="searchField" name="term" autocomplete="off"><br />
    <div id="popups"></div>
  </form>
</div>
         </td></tr><tr><td id="tdnav">
<a id="navPanePlaceHolder" href="/Recipes/navigate.html" >Navigation</a>
<script type="text/javascript"> var navigationPaneSource="/Recipes/navigate.html"; </script></td><td id="tdconcept">
<div id="conceptPane">

<div id="Name">
<span class="sectionHead">Name</span> <a href="/Recipes/Recipes.html">Recipes</a>/<a href="/Recipes/Languages/Languages.html">Languages</a>/<a href="/Recipes/Languages/Pico/Pico.html">Pico</a>/<a href="/Recipes/Languages/Pico/Evaluate/Evaluate.html">Evaluate</a>
</div>

<div id="Synopsis">
<span class="sectionHead">Synopsis</span>  Evaluate a Pico program.

</div>

	                       
                           
                           
                           
  	                       
<div id="Examples">
<span class="sectionHead">Examples</span>  A complete evaluator (interpreter) for Pico is defined below.
 <pre class="listing">module demo::lang::Pico::Eval

import Prelude;
import demo::lang::Pico::Abstract;
import demo::lang::Pico::Load;


data PicoValue = natval(int n) | strval(str s) | errorval(loc l, str msg);  <img src="/images/1.png">

alias VENV = map[PicoId, PicoValue];                                        <img src="/images/2.png">

// Evaluate Expressions.

PicoValue evalExp(exp:natCon(int N), VENV env) = natval(N);

PicoValue evalExp(exp:strCon(str S), VENV env) = strval(S);

PicoValue evalExp(exp:id(PicoId Id), VENV env)  = 
    env[Id]?  ? env[Id] : errorval(exp@location, "Uninitialized variable &lt;Id>");

PicoValue evalExp(exp:add(EXP E1, EXP E2), VENV env) = 
   (natval(n1) := evalExp(E1, env) &amp;&amp; 
    natval(n2) := evalExp(E2, env)) ? natval(n1 + n2)
                                    : errorval(exp@location, "+ requires natural arguments");
  
PicoValue evalExp(exp:sub(EXP E1, EXP E2), VENV env) = 
   (natval(n1) := evalExp(E1, env) &amp;&amp; 
    natval(n2) := evalExp(E2, env)) ? natval(n1 - n2)
                                    : errorval(exp@location, "- requires natural arguments");
                                                                     
PicoValue evalExp(exp:conc(EXP E1, EXP E2), VENV env) = 
   (strval(s1) := evalExp(E1, env) &amp;&amp; 
    strval(s2) := evalExp(E2, env)) ? strval(s1 + s2)
                                    : errorval(exp@location, "|| requires string arguments");

// Evaluate a statement

VENV evalStat(stat:asgStat(PicoId Id, EXP Exp), VENV env) {
  env[Id] = evalExp(Exp, env);
  return env;
}
	
VENV evalStat(stat:ifElseStat(EXP Exp, 
                              list[STATEMENT] Stats1,
                              list[STATEMENT] Stats2),
              VENV env) =
  evalStats(evalExp(Exp, env) != natval(0) ? Stats1 : Stats2, env);

VENV evalStat(stat:whileStat(EXP Exp, 
                             list[STATEMENT] Stats1),
              VENV env) {
    while(evalExp(Exp, env) != natval(0)){
       env = evalStats(Stats1, env);
    }
    return env;
}

// Evaluate a list of statements
VENV evalStats(list[STATEMENT] Stats1, VENV env) {
  for(S &lt;- Stats1){
      env = evalStat(S, env);
  }
  return env;
}
  
// Eval declarations

VENV evalDecls(list[DECL] Decls) =
    ( Id : (tp == natural() ? natval(0) : strval(""))  | decl(PicoId Id, TYPE tp) &lt;- Decls);

// Evaluate a Pico program

public VENV evalProgram(PROGRAM P){
  if(program(list[DECL] Decls, list[STATEMENT] Series) := P){
     VENV env = evalDecls(Decls);
     return evalStats(Series, env);
  } else
    throw "Cannot happen";
}

public VENV evalProgram(str txt) = evalProgram(load(txt));

    
</pre> Notes:
 <ul><li> First we introduce a data type <code>PicoValue</code> (<img src="/images/1.png">) that wraps all possible values that can occur at run-time.</li>
<li> Compared to <a href="/Recipes/Languages/Pico/Typecheck/Typecheck.html">Pico/Typecheck</a>, we use <code>VENV</code> (<img src="/images/2.png">), a value environment (a map from Pico identifiers to Pico values).</li>
<li> The actual evaluator consists of the functions <code>evalExp</code>, <code>evalStat</code>, <code>evalStats</code>, <code>evalDecls</code> and <code>evalProgram</code>.   They are written in a similar style as the typechecker.
</li>
<li> <code>evalProgram</code> evaluates a given Pico program.</li>
</ul> Here is how to evaluate a Pico program:
 <pre class="screen"><span class="prompt">rascal></span>import demo::lang::Pico::Eval;
ok
<span class="prompt">rascal></span>evalProgram(&quot;begin declare x : natural, y : natural; x := 1; y := x + 5 end&quot;);
VENV: (
  "y":natval(6),
  "x":natval(1)
)
</pre>
</div>

  	                       
  	                       
  	                       
<a id="tutorAction" href="/index.html"><img id="leftIcon" height="40" width="40" src="/images/rascal-tutor-small.png"></a><div id="editMenu">[<a id="editAction" href="/edit?concept=Recipes/Languages/Pico/Evaluate&new=false"><b>Edit</b></a>] | 
               [<a id="newAction" href="/edit?concept=Recipes/Languages/Pico/Evaluate&new=true"><b>New Subconcept</b></a>] |
               [<a id="compileAction" href="/compile?name=Recipes"><b>Recompile Course</b></a>] |
               [<a id="warnAction" href="/Recipes/warnings.html"><b>Warnings</b></a>]</div>
<span class="editMenuFooter">Is this page unclear, or have you spotted an error? Please add a comment below and help us to improve it. For all other questions and remarks, visit <a href="http://ask.rascal-mpl.org">ask.rascal-mpl.org</a>. </span>
</div>
</td></tr></table>
</body>
</html>